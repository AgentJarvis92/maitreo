<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Get Started - Maitreo</title>
    <meta name="description" content="Sign up for Maitreo and start your 14-day free trial.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Outfit:wght@600;700;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #FAFAFA;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: #111827;
        }
        .container {
            max-width: 520px;
            width: 100%;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.08);
            padding: 40px;
            animation: slideUp 0.4s ease;
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .logo { text-align: center; margin-bottom: 8px; }
        .logo h1 {
            font-family: 'Outfit', sans-serif;
            font-size: 32px; font-weight: 700;
            color: #EF6C00;
        }

        /* Progress bar */
        .progress-bar {
            display: flex; gap: 6px; margin-bottom: 28px; padding: 0 4px;
        }
        .progress-step {
            flex: 1; height: 4px; border-radius: 2px; background: #e0e0e0;
            transition: background 0.3s ease;
        }
        .progress-step.active { background: #EF6C00; }
        .progress-step.done { background: #22c55e; }
        .step-label {
            text-align: center; color: #6B7280; font-size: 13px; margin-bottom: 20px;
        }

        /* Form elements */
        .step { display: none; animation: fadeIn 0.3s ease; }
        .step.active { display: block; }
        .form-group { margin-bottom: 18px; }
        label { display: block; margin-bottom: 6px; color: #374151; font-weight: 500; font-size: 14px; }
        input {
            width: 100%; padding: 13px 16px; border: 2px solid #e0e0e0; border-radius: 8px;
            font-size: 16px; transition: all 0.2s; font-family: inherit;
        }
        input:focus { outline: none; border-color: #EF6C00; box-shadow: 0 0 0 3px rgba(239,108,0,0.1); }
        input.error { border-color: #ef4444; }
        .error-msg { color: #ef4444; font-size: 13px; margin-top: 5px; min-height: 18px; }
        .subtitle {
            text-align: center; color: #374151; margin-bottom: 24px; font-size: 15px; line-height: 1.5;
            font-family: 'Outfit', sans-serif; font-weight: 600;
        }

        /* Buttons */
        .btn {
            width: 100%; padding: 15px; border: none; border-radius: 8px; font-size: 16px;
            font-weight: 600; cursor: pointer; transition: all 0.2s; margin-top: 8px;
            font-family: 'Inter', sans-serif;
        }
        .btn-primary {
            background: #EF6C00; color: white;
        }
        .btn-primary:hover:not(:disabled) { background: #E65100; transform: translateY(-2px); box-shadow: 0 8px 20px rgba(239,108,0,0.3); }
        .btn-secondary {
            background: white; color: #EF6C00; border: 2px solid #EF6C00; margin-top: 12px;
        }
        .btn-secondary:hover:not(:disabled) { background: #FFF3E0; }
        .btn-google {
            background: white; color: #374151; border: 2px solid #e0e0e0; display: flex;
            align-items: center; justify-content: center; gap: 10px;
        }
        .btn-google:hover:not(:disabled) { border-color: #4285f4; background: #f8f9ff; }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none !important; }

        /* OTP input */
        .otp-group {
            display: flex; gap: 8px; justify-content: center; margin: 20px 0;
        }
        .otp-input {
            width: 48px; height: 56px; text-align: center; font-size: 24px; font-weight: 600;
            border: 2px solid #e0e0e0; border-radius: 8px; padding: 0;
        }
        .otp-input:focus { border-color: #EF6C00; box-shadow: 0 0 0 3px rgba(239,108,0,0.1); outline: none; }

        /* Resend link */
        .resend-link {
            text-align: center; margin-top: 16px; font-size: 14px; color: #6B7280;
        }
        .resend-link a {
            color: #EF6C00; text-decoration: none; cursor: pointer;
        }
        .resend-link a:hover { text-decoration: underline; }
        .resend-link a.disabled { color: #ccc; pointer-events: none; }

        /* Success */
        .success-icon { font-size: 64px; text-align: center; margin-bottom: 16px; }
        .success-title {
            text-align: center; font-size: 24px; font-weight: 600; color: #111827; margin-bottom: 12px;
            font-family: 'Outfit', sans-serif;
        }
        .success-text { text-align: center; color: #374151; line-height: 1.6; margin-bottom: 24px; }

        /* Info box */
        .info-box {
            background: #FFF3E0; border-radius: 8px; padding: 16px; margin: 16px 0;
            font-size: 14px; color: #374151; line-height: 1.5;
        }
        .info-box strong { color: #111827; }

        /* Pricing card */
        .pricing-card {
            background: #FAFAFA; border-radius: 12px; padding: 24px; text-align: center; margin: 16px 0;
            border: 1px solid #e0e0e0;
        }
        .pricing-card .price { font-size: 36px; font-weight: 700; color: #111827; font-family: 'Outfit', sans-serif; }
        .pricing-card .price span { font-size: 16px; font-weight: 400; color: #6B7280; }
        .pricing-card .trial-badge {
            display: inline-block; background: #22c55e; color: white; padding: 4px 12px;
            border-radius: 20px; font-size: 13px; font-weight: 600; margin-top: 8px;
        }
        .pricing-features {
            text-align: left; margin: 16px 0 0; padding: 0; list-style: none;
        }
        .pricing-features li {
            padding: 6px 0; color: #374151; font-size: 14px;
        }
        .pricing-features li::before { content: '‚úì '; color: #22c55e; font-weight: 700; }

        /* Connection status */
        .connection-status {
            display: flex; align-items: center; gap: 12px; padding: 16px;
            background: #f0fdf4; border-radius: 8px; margin: 16px 0;
        }
        .connection-status.pending { background: #FFF3E0; }
        .connection-status .icon { font-size: 24px; }
        .connection-status .text { font-size: 14px; color: #374151; }

        /* Spinner */
        .spinner {
            display: inline-block; width: 18px; height: 18px;
            border: 3px solid rgba(255,255,255,0.3); border-top-color: white;
            border-radius: 50%; animation: spin 0.7s linear infinite; vertical-align: middle;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Trust badges */
        .trust-row {
            display: flex; justify-content: center; gap: 20px; margin-top: 20px;
            padding-top: 16px; border-top: 1px solid #e0e0e0; flex-wrap: wrap;
        }
        .trust-row span { color: #EF6C00; font-size: 13px; font-weight: 500; }

        .back-link { text-align: center; margin-top: 16px; }
        .back-link a { color: #EF6C00; text-decoration: none; font-size: 14px; }
        .back-link a:hover { text-decoration: underline; }

        /* Global error banner */
        .global-error {
            background: #fef2f2; border: 1px solid #fecaca; border-radius: 8px;
            padding: 12px 16px; margin-bottom: 16px; color: #dc2626; font-size: 14px;
            display: none;
        }
        .global-error.show { display: block; }

        /* Disclosure */
        .disclosure {
            text-align: center; color: #6B7280; font-size: 12px; margin-top: 12px;
        }

        /* Resume banner */
        .resume-banner {
            background: #FFF3E0; border: 1px solid #EF6C00; border-radius: 8px;
            padding: 12px 16px; margin-bottom: 16px; color: #E65100; font-size: 14px;
            display: none; text-align: center;
        }
        .resume-banner.show { display: block; }

        @media (max-width: 600px) {
            .container { padding: 28px 20px; }
            .logo h1 { font-size: 28px; }
            .otp-input { width: 42px; height: 48px; font-size: 20px; }
            .trust-row { flex-direction: column; gap: 6px; align-items: center; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo"><h1>Maitreo</h1></div>

        <!-- Progress -->
        <div class="progress-bar">
            <div class="progress-step" id="prog-1"></div>
            <div class="progress-step" id="prog-2"></div>
            <div class="progress-step" id="prog-3"></div>
            <div class="progress-step" id="prog-4"></div>
            <div class="progress-step" id="prog-5"></div>
        </div>
        <div class="step-label" id="stepLabel"></div>
        <div class="resume-banner" id="resumeBanner">Welcome back! Picking up where you left off.</div>
        <div class="global-error" id="globalError"></div>

        <!-- STEP 1: Account Creation -->
        <div class="step" id="step-1">
            <div class="subtitle">Create your account to get started</div>
            <form id="accountForm" novalidate>
                <div class="form-group">
                    <label for="name">Restaurant Name *</label>
                    <input type="text" id="name" placeholder="Joe's Pizza" required>
                    <div class="error-msg" id="nameError"></div>
                </div>
                <div class="form-group">
                    <label for="address">Address *</label>
                    <input type="text" id="address" placeholder="123 Main St, Chicago, IL 60601" required>
                    <div class="error-msg" id="addressError"></div>
                </div>
                <div class="form-group">
                    <label for="phone">Phone Number *</label>
                    <input type="tel" id="phone" placeholder="(312) 555-0123" required>
                    <div class="error-msg" id="phoneError"></div>
                </div>
                <div class="form-group">
                    <label for="email">Email Address *</label>
                    <input type="email" id="email" placeholder="owner@joespizza.com" required>
                    <div class="error-msg" id="emailError"></div>
                </div>
                <button type="submit" class="btn btn-primary" id="step1Btn">
                    <span class="btn-text">Continue</span>
                </button>
            </form>
            <div class="trust-row">
                <span>‚úì 14-day free trial</span>
                <span>‚úì Cancel anytime</span>
            </div>
            <div class="back-link"><a href="https://maitreo.com">‚Üê Back to home</a></div>
        </div>

        <!-- STEP 2: Phone Verification -->
        <div class="step" id="step-2">
            <div class="subtitle">Verify your phone number</div>
            <p style="text-align:center;color:#374151;font-size:14px;margin-bottom:8px;">
                We sent a 6-digit code to <strong id="otpPhone"></strong>
            </p>
            <div class="otp-group" id="otpGroup">
                <input class="otp-input" type="text" maxlength="1" inputmode="numeric" pattern="[0-9]">
                <input class="otp-input" type="text" maxlength="1" inputmode="numeric" pattern="[0-9]">
                <input class="otp-input" type="text" maxlength="1" inputmode="numeric" pattern="[0-9]">
                <input class="otp-input" type="text" maxlength="1" inputmode="numeric" pattern="[0-9]">
                <input class="otp-input" type="text" maxlength="1" inputmode="numeric" pattern="[0-9]">
                <input class="otp-input" type="text" maxlength="1" inputmode="numeric" pattern="[0-9]">
            </div>
            <div class="error-msg" id="otpError" style="text-align:center;"></div>
            <button class="btn btn-primary" id="verifyOtpBtn" disabled>
                <span class="btn-text">Verify</span>
            </button>
            <div class="resend-link">
                Didn't get a code? <a id="resendLink" class="disabled">Resend (<span id="resendTimer">60</span>s)</a>
            </div>
        </div>

        <!-- STEP 3: Stripe Trial Activation -->
        <div class="step" id="step-3">
            <div class="subtitle">Start your free trial</div>
            <div class="pricing-card">
                <div class="price">$99<span>/month</span></div>
                <div class="trial-badge">14-DAY FREE TRIAL</div>
                <ul class="pricing-features">
                    <li>24/7 review monitoring</li>
                    <li>AI-powered response drafts</li>
                    <li>SMS alerts for new reviews</li>
                    <li>Reputation analytics</li>
                </ul>
            </div>
            <div class="info-box">
                <strong>No charge today.</strong> Your card will only be billed after the 14-day trial ends. Cancel anytime.
            </div>
            <button class="btn btn-primary" id="stripeBtn">
                <span class="btn-text">Start Free Trial</span>
            </button>
            <button class="btn btn-secondary" id="skipStripeBtn" style="font-size:13px;color:#6B7280;border-color:#e0e0e0;">
                Skip for now
            </button>
        </div>

        <!-- STEP 4: Connect Google -->
        <div class="step" id="step-4">
            <div class="subtitle">Connect your business profile</div>
            <div class="info-box">
                Connect your Google Business Profile so Maitreo can monitor your reviews and help you respond.
            </div>
            <div id="googleStatus" class="connection-status pending" style="display:none;">
                <span class="icon">‚úÖ</span>
                <span class="text">Google Business Profile connected!</span>
            </div>
            <button class="btn btn-google" id="googleBtn">
                <svg width="20" height="20" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/></svg>
                <span class="btn-text">Connect Google Business Profile</span>
            </button>
            <button class="btn btn-secondary" id="skipGoogleBtn" style="font-size:13px;color:#6B7280;border-color:#e0e0e0;">
                I'll do this later
            </button>
            <div class="disclosure">Currently supports Google Business Profile.</div>
        </div>

        <!-- STEP 5: Success -->
        <div class="step" id="step-5">
            <div class="success-icon">üéâ</div>
            <div class="success-title">You're all set!</div>
            <div class="success-text">
                Maitreo is now monitoring your reviews 24/7.<br>
                We'll text you when new reviews come in with a draft response ready to go.
            </div>
            <div class="info-box" style="text-align:center;">
                üì± Check your phone ‚Äî we just sent you a welcome text.
            </div>
            <a href="https://maitreo.com" class="btn btn-primary" style="display:block;text-align:center;text-decoration:none;margin-top:16px;">
                Back to Maitreo
            </a>
        </div>
    </div>

    <script>
    (function() {
        // ‚îÄ‚îÄ Config ‚îÄ‚îÄ
        const API_URL = window.location.hostname === 'localhost'
            ? 'http://localhost:3000'
            : 'https://restaurant-saas-backend-pbbx.onrender.com';

        // ‚îÄ‚îÄ State ‚îÄ‚îÄ
        let currentStep = 1;
        let restaurantId = null;
        let phoneNumber = '';
        let resendCountdown = null;

        // Check URL params (Stripe return or resume)
        const urlParams = new URLSearchParams(window.location.search);
        const stepParam = parseInt(urlParams.get('step'));
        const ridParam = urlParams.get('rid');
        if (stepParam && ridParam) {
            restaurantId = ridParam;
            currentStep = stepParam;
            window.history.replaceState({}, '', '/onboarding.html');
        }

        // ‚îÄ‚îÄ DOM refs ‚îÄ‚îÄ
        const steps = [1,2,3,4,5];
        const globalError = document.getElementById('globalError');

        function showStep(n) {
            currentStep = n;
            steps.forEach(i => {
                document.getElementById(`step-${i}`).classList.toggle('active', i === n);
                const prog = document.getElementById(`prog-${i}`);
                prog.classList.toggle('done', i < n);
                prog.classList.toggle('active', i === n);
            });
            const labels = ['Step 1 of 5 ‚Äî Account', 'Step 2 of 5 ‚Äî Verify Phone', 'Step 3 of 5 ‚Äî Trial', 'Step 4 of 5 ‚Äî Connect', 'Step 5 of 5 ‚Äî Done!'];
            document.getElementById('stepLabel').textContent = labels[n - 1];
            globalError.classList.remove('show');
        }

        function showGlobalError(msg) {
            globalError.textContent = msg;
            globalError.classList.add('show');
        }

        function setLoading(btn, loading) {
            if (loading) {
                btn.disabled = true;
                btn.dataset.origText = btn.querySelector('.btn-text')?.textContent || btn.textContent;
                const txt = btn.querySelector('.btn-text');
                if (txt) txt.innerHTML = '<span class="spinner"></span>';
            } else {
                btn.disabled = false;
                const txt = btn.querySelector('.btn-text');
                if (txt) txt.textContent = btn.dataset.origText || 'Continue';
            }
        }

        async function api(path, data) {
            const res = await fetch(`${API_URL}${path}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            return res.json();
        }

        // ‚îÄ‚îÄ Resume Logic ‚îÄ‚îÄ
        async function checkResume() {
            if (!ridParam) return;
            restaurantId = ridParam;
            try {
                const res = await fetch(`${API_URL}/onboarding/status?rid=${ridParam}`);
                if (!res.ok) return;
                const status = await res.json();
                if (status.onboarding_complete) { showStep(5); return; }
                if (status.google_connected) { showStep(5); completeOnboarding(); return; }
                if (status.stripe_active) { showStep(4); }
                else if (status.phone_verified) { showStep(3); }
                else { showStep(2); }
                document.getElementById('resumeBanner').classList.add('show');
                setTimeout(() => document.getElementById('resumeBanner').classList.remove('show'), 4000);
            } catch (e) {
                console.error('Resume check failed:', e);
            }
        }

        // ‚îÄ‚îÄ STEP 1: Account Creation ‚îÄ‚îÄ
        const accountForm = document.getElementById('accountForm');
        const step1Btn = document.getElementById('step1Btn');

        document.getElementById('phone').addEventListener('input', function(e) {
            let v = e.target.value.replace(/\D/g, '').slice(0, 10);
            if (v.length >= 6) v = `(${v.slice(0,3)}) ${v.slice(3,6)}-${v.slice(6)}`;
            else if (v.length >= 3) v = `(${v.slice(0,3)}) ${v.slice(3)}`;
            e.target.value = v;
        });

        accountForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            ['name','address','phone','email'].forEach(f => {
                document.getElementById(f).classList.remove('error');
                document.getElementById(f + 'Error').textContent = '';
            });

            const data = {
                name: document.getElementById('name').value.trim(),
                address: document.getElementById('address').value.trim(),
                phone: document.getElementById('phone').value.trim(),
                email: document.getElementById('email').value.trim()
            };

            let hasErr = false;
            function fieldErr(f, msg) { document.getElementById(f).classList.add('error'); document.getElementById(f+'Error').textContent = msg; hasErr = true; }

            if (!data.name) fieldErr('name', 'Restaurant name is required');
            if (!data.address) fieldErr('address', 'Address is required');
            if (!data.phone || data.phone.replace(/\D/g,'').length < 10) fieldErr('phone', 'Enter a valid 10-digit phone number');
            if (!data.email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(data.email)) fieldErr('email', 'Enter a valid email address');
            if (hasErr) return;

            setLoading(step1Btn, true);
            try {
                const result = await api('/onboarding/register', data);
                if (result.success) {
                    restaurantId = result.restaurantId;
                    phoneNumber = data.phone;
                    document.getElementById('otpPhone').textContent = data.phone;
                    showStep(2);
                    startResendTimer();
                    sendOtp();
                    setTimeout(() => document.querySelector('.otp-input').focus(), 100);
                } else {
                    showGlobalError(result.message || 'Something went wrong. Please try again.');
                }
            } catch (err) {
                showGlobalError('Unable to connect. Please check your connection and try again.');
            } finally {
                setLoading(step1Btn, false);
            }
        });

        // ‚îÄ‚îÄ STEP 2: OTP Verification ‚îÄ‚îÄ
        const otpInputs = document.querySelectorAll('.otp-input');
        const verifyBtn = document.getElementById('verifyOtpBtn');

        otpInputs.forEach((inp, i) => {
            inp.addEventListener('input', (e) => {
                const val = e.target.value.replace(/\D/g, '');
                e.target.value = val.slice(0, 1);
                if (val && i < otpInputs.length - 1) otpInputs[i + 1].focus();
                checkOtpComplete();
            });
            inp.addEventListener('keydown', (e) => {
                if (e.key === 'Backspace' && !e.target.value && i > 0) {
                    otpInputs[i - 1].focus();
                }
            });
            inp.addEventListener('paste', (e) => {
                e.preventDefault();
                const text = (e.clipboardData || window.clipboardData).getData('text').replace(/\D/g, '').slice(0, 6);
                text.split('').forEach((c, j) => { if (otpInputs[j]) otpInputs[j].value = c; });
                checkOtpComplete();
                if (text.length > 0) otpInputs[Math.min(text.length, 5)].focus();
            });
        });

        function getOtpCode() {
            return Array.from(otpInputs).map(i => i.value).join('');
        }

        function checkOtpComplete() {
            verifyBtn.disabled = getOtpCode().length < 6;
        }

        async function sendOtp() {
            try {
                await api('/onboarding/otp/send', { restaurantId, phone: phoneNumber });
            } catch (err) {
                showGlobalError('Failed to send verification code. Please try again.');
            }
        }

        function startResendTimer() {
            let seconds = 60;
            const timerEl = document.getElementById('resendTimer');
            const linkEl = document.getElementById('resendLink');
            linkEl.classList.add('disabled');
            clearInterval(resendCountdown);
            resendCountdown = setInterval(() => {
                seconds--;
                timerEl.textContent = seconds;
                if (seconds <= 0) {
                    clearInterval(resendCountdown);
                    linkEl.classList.remove('disabled');
                    linkEl.innerHTML = 'Resend code';
                }
            }, 1000);
        }

        document.getElementById('resendLink').addEventListener('click', (e) => {
            e.preventDefault();
            if (e.target.classList.contains('disabled')) return;
            sendOtp();
            startResendTimer();
            document.getElementById('resendLink').innerHTML = 'Resend (<span id="resendTimer">60</span>s)';
        });

        verifyBtn.addEventListener('click', async () => {
            document.getElementById('otpError').textContent = '';
            setLoading(verifyBtn, true);
            try {
                const result = await api('/onboarding/otp/verify', {
                    restaurantId,
                    code: getOtpCode()
                });
                if (result.success) {
                    showStep(3);
                } else {
                    document.getElementById('otpError').textContent = result.message || 'Invalid code. Please try again.';
                    otpInputs.forEach(i => i.value = '');
                    otpInputs[0].focus();
                }
            } catch (err) {
                showGlobalError('Verification failed. Please try again.');
            } finally {
                setLoading(verifyBtn, false);
            }
        });

        // ‚îÄ‚îÄ STEP 3: Stripe Trial ‚îÄ‚îÄ
        document.getElementById('stripeBtn').addEventListener('click', async () => {
            const btn = document.getElementById('stripeBtn');
            setLoading(btn, true);
            try {
                const result = await api('/onboarding/stripe/create-session', { restaurantId });
                if (result.url) {
                    window.location.href = result.url;
                } else if (result.stub) {
                    showStep(4);
                } else {
                    showGlobalError(result.message || 'Could not start checkout. Try again.');
                }
            } catch (err) {
                showGlobalError('Unable to connect to payment service.');
            } finally {
                setLoading(btn, false);
            }
        });

        document.getElementById('skipStripeBtn').addEventListener('click', () => showStep(4));

        // ‚îÄ‚îÄ STEP 4: Connect Google ‚îÄ‚îÄ
        document.getElementById('googleBtn').addEventListener('click', async () => {
            const btn = document.getElementById('googleBtn');
            setLoading(btn, true);
            try {
                window.location.href = `${API_URL}/auth/google/start?restaurant_id=${restaurantId}&return_url=${encodeURIComponent(window.location.origin + '/onboarding.html?step=5&rid=' + restaurantId)}`;
            } catch (err) {
                showGlobalError('Could not start Google connection.');
                setLoading(btn, false);
            }
        });

        document.getElementById('skipGoogleBtn').addEventListener('click', () => {
            completeOnboarding();
        });

        // ‚îÄ‚îÄ STEP 5: Complete ‚îÄ‚îÄ
        async function completeOnboarding() {
            showStep(5);
            try {
                await api('/onboarding/complete', { restaurantId });
            } catch (err) {
                console.error('Complete call failed:', err);
            }
        }

        // If we land on step 5 (from OAuth return), trigger completion
        if (currentStep === 5) {
            completeOnboarding();
        }

        // Init: check resume first, then show step
        if (ridParam && !stepParam) {
            checkResume();
        } else {
            showStep(currentStep);
        }
        if (!ridParam || stepParam) {
            showStep(currentStep);
        }
    })();
    </script>
</body>
</html>
